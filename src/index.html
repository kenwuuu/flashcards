<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AI Vocabulary Practice</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
<div class="bg-white p-8 rounded-2xl shadow-lg max-w-lg w-full">
    <h1 class="text-2xl font-bold mb-4 text-center">Vocabulary Practice</h1>

    <!-- Input section -->
    <div id="input-section">
        <label class="block mb-2 text-gray-700">AI Provider:</label>
        <select id="providerSelect" class="w-full border rounded-lg p-2 mb-4">
            <option value="openai">OpenAI</option>
            <option value="claude">Claude (Anthropic)</option>
            <option value="gemini">Gemini (Google)</option>
        </select>

        <label class="block mb-2 text-gray-700">API Key:</label>
        <input id="apiKeyInput" type="password" placeholder="Your API Key" class="w-full border rounded-lg p-2 mb-4" />

        <label class="block mb-2 text-gray-700">Select grade level:</label>
        <select id="gradeSelect" class="w-full border rounded-lg p-2 mb-4">
            <option value="kindergartener">Kindergarten</option>
            <option value="1st grade">1st Grade</option>
            <option value="2nd grade">2nd Grade</option>
            <option value="3rd grade">3rd Grade</option>
            <option value="4th grade">4th Grade</option>
            <option value="5th grade">5th Grade</option>
            <option value="6th grade">6th Grade</option>
            <option value="7th grade">7th Grade</option>
            <option value="8th grade">8th Grade</option>
            <option value="9th grade">9th Grade</option>
            <option value="10th grade">10th Grade</option>
            <option value="11th grade">11th Grade</option>
            <option value="12th grade">12th Grade</option>
            <option value="undergraduate">Undergraduate</option>
            <option value="post graduate">Graduate</option>
        </select>

        <label class="block mb-2 text-gray-700">Enter your words (comma or newline separated):</label>
        <textarea id="wordInput" rows="6" class="w-full border rounded-lg p-2 mb-4"></textarea>

        <button id="startBtn" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">Start Practice</button>
    </div>

    <!-- Flashcard section -->
    <div id="flashcard-section" class="hidden flex flex-col items-center">
        <div id="sentenceDisplay" class="text-xl text-center my-8 min-h-[4rem]"></div>
        <div class="flex items-center gap-4">
            <button id="nextBtn" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">Next</button>
            <span id="progress" class="text-gray-600"></span>
        </div>
    </div>
</div>

<script>
    const startBtn = document.getElementById('startBtn');
    const nextBtn = document.getElementById('nextBtn');
    const providerSelect = document.getElementById('providerSelect');
    const apiKeyInput = document.getElementById('apiKeyInput');
    const gradeSelect = document.getElementById('gradeSelect');
    const wordInput = document.getElementById('wordInput');
    const inputSection = document.getElementById('input-section');
    const flashcardSection = document.getElementById('flashcard-section');
    const sentenceDisplay = document.getElementById('sentenceDisplay');
    const progress = document.getElementById('progress');

    let words = [];
    let currentIndex = 0;
    let apiKey = '';
    let provider = '';
    let gradeLevel = '';
    let preloadedSentence = null;

    async function fetchSentence(word) {
        const prompt = `Use "${word}" in a sentence. Write it at a ${gradeLevel} level.`;

        if (provider === 'openai') {
            const response = await fetch("https://api.openai.com/v1/completions", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: "text-davinci-003",
                    prompt: prompt,
                    max_tokens: 50,
                    temperature: 0.7
                })
            });
            if (!response.ok) throw new Error((await response.json()).error?.message || 'OpenAI API error');
            const data = await response.json();
            return data.choices[0].text.trim();
        }

        if (provider === 'claude') {
            const response = await fetch("https://api.anthropic.com/v1/complete", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "x-api-key": apiKey,
                    "anthropic-version": "2023-06-01"
                },
                body: JSON.stringify({
                    prompt: `\n\nHuman: ${prompt}\n\nAssistant:`,  // todo this looks fucky, should it just be 'prompt'?
                    model: "claude-instant-1",
                    max_tokens_to_sample: 50
                })
            });
            if (!response.ok) throw new Error((await response.json()).error?.message || 'Claude API error');
            const data = await response.json();
            return data.completion.trim();
        }

        if (provider === 'gemini') {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }]
                })
            });
            if (!response.ok) throw new Error((await response.json()).error?.message || 'Gemini API error');
            const data = await response.json();
            return data.candidates[0].content.parts[0].text.trim();
        }

        throw new Error("Unsupported AI provider");
    }

    async function preloadNextSentence() {
        if (currentIndex + 1 >= words.length) {
            preloadedSentence = null;
            return;
        }
        const nextWord = words[currentIndex + 1];
        try {
            preloadedSentence = await fetchSentence(nextWord);
        } catch (err) {
            preloadedSentence = `Error fetching "${nextWord}": ${err.message}`;
        }
    }

    async function showSentence() {
        const word = words[currentIndex];

        let sentence;
        if (currentIndex === 0 || !preloadedSentence) {
            sentenceDisplay.textContent = 'Loading...';
            try {
                sentence = await fetchSentence(word);
            } catch (err) {
                sentence = `Error: ${err.message}`;
            }
        } else {
            sentence = preloadedSentence;
        }

        sentenceDisplay.textContent = sentence;
        progress.textContent = `${currentIndex + 1} / ${words.length}`;
        preloadNextSentence();
    }

    startBtn.addEventListener('click', async () => {
        apiKey = apiKeyInput.value.trim();
        provider = providerSelect.value;
        gradeLevel = gradeSelect.value;
        const rawInput = wordInput.value.trim();

        if (!apiKey) {
            alert('Please enter a valid API key.');
            return;
        }

        if (!rawInput) {
            alert('Please enter at least one word.');
            return;
        }

        words = rawInput.split(/[\n,]+/).map(w => w.trim()).filter(Boolean);
        if (words.length === 0) {
            alert('No valid words found.');
            return;
        }

        currentIndex = 0;
        preloadedSentence = null;
        inputSection.classList.add('hidden');
        flashcardSection.classList.remove('hidden');

        showSentence();
    });

    nextBtn.addEventListener('click', async () => {
        currentIndex++;
        if (currentIndex >= words.length) {
            alert('Youâ€™ve finished all the words!');
            inputSection.classList.remove('hidden');
            flashcardSection.classList.add('hidden');
            apiKeyInput.value = '';
            wordInput.value = '';
            return;
        }
        showSentence();
    });
</script>
</body>
</html>
